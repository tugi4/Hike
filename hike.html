<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
    <style>

        #map {
            height: 400px;
            width: 90%;
            margin-left: 20px;
        }

        .leaflet-control-attribution{
            display: none;
        }

    </style>
    <link rel="stylesheet" href="hike.css">
    <script type="text/javascript" src="hike.js"></script>
    <script type="text/javascript" src="main.js"></script>
</head>
<body>
<div id="navBar">
    <div>
        <img src="image/icons8-mountain-100.png" alt="Let's Hike logo" height="96%">
        <a href="create.html">Create Hike</a>
    </div>
    <div>
        <img src="image/icons8-login-67.png" alt="login" height="70%">
    </div>
</div>
<div class="likes">
    <img class="like" src="./image/icons8-like-50.png" alt="like">
</div>

<div id="selected">
    <div id="ww_da6967281f185" style="max-width: 480px" v='1.3' loc='id' a='{"t":"horizontal","lang":"en","sl_lpl":1,"ids":[],"font":"Arial","sl_ics":"one_a","sl_sot":"celsius","cl_bkg":"image","cl_font":"#FFFFFF","cl_cloud":"#FFFFFF","cl_persp":"#81D4FA","cl_sun":"#FFC107","cl_moon":"#FFC107","cl_thund":"#FF5722","el_nme":3}'>More forecasts: <a href="https://oneweather.org/fr/paris/20_jours/" id="ww_da6967281f185_u" target="_blank">Prévisions météo 20 jours</a></div><script async src="https://app2.weatherwidget.org/js/?id=ww_da6967281f185"></script>
    <div class="monthLabel">The best month</div>
    <div id="tour-months">
        <div class="tour-month">Jan</div>
        <div class="tour-month">Feb</div>
        <div class="tour-month">Mar</div>
        <div class="tour-month">Apr</div>
        <div class="tour-month">May</div>
        <div class="tour-month">Jun</div>
        <div class="tour-month">Jul</div>
        <div class="tour-month">Aug</div>
        <div class="tour-month">Sep</div>
        <div class="tour-month">Oct</div>
        <div class="tour-month">Nov</div>
        <div class="tour-month">Dec</div>
    </div>
    <div class="descriptionLabel"> Description</div>
</div>
<script>

    // Function to get the value of a specific query parameter from the URL

    function getQueryParam(parameter) {
        var queryString = window.location.search;
        var urlParams = new URLSearchParams(queryString);
        return urlParams.get(parameter);
    }

    // Get the value of the "selectedElement" query parameter
    var selectedElement = getQueryParam('selectedElement');


    // Fetch data from the database based on the selected element

    function fetchHike() {
        fetch('http://localhost:30000/hike-db')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                const list = document.getElementById('selected');
                //list.innerHTML = ''; // Clear existing list items, if any

                data.forEach(item => {
                    if (item.name === selectedElement) {
                        let base64 = item.image;
                        const name = document.createElement('div');
                        name.textContent = item.name;
                        name.className = "hikeName";
                        const img = new Image();
                        img.src = base64;
                        img.className = "hikeImg";
                        const myMap = document.createElement('div');
                        myMap.id = 'map';
                        const description = document.createElement('div');
                        description.textContent = item.description;
                        description.className = "description";

                        fetchMonthBox(item.hikeid);

                        const box = document.createElement('div');
                        box.className = 'location';

                        box.textContent = item.region + ' ' + item.location;
                        list.appendChild(box);

                        const box2 = document.createElement('div');
                        box2.className = 'info';

                        const duration = document.createElement('div');
                        const durationImg = new Image();
                        durationImg.src = "./image/icons8-time-50.png";
                        duration.textContent = item.duration.slice(0, 5);
                        const cDuration = document.createElement('div');
                        cDuration.appendChild(durationImg);
                        cDuration.appendChild(duration);
                        cDuration.style.display = 'flex';
                        cDuration.style.alignItems = 'center';
                        cDuration.style.gap = '10px';
                        box2.appendChild(cDuration);

                        const cLength = document.createElement('div');
                        const lengthImg = new Image();
                        lengthImg.src = "./image/icons8-trekking-48.png";
                        const length = document.createElement('div');
                        length.textContent = item.length + ' km';
                        cLength.appendChild(lengthImg);
                        cLength.appendChild(length);
                        box2.appendChild(cLength);
                        cLength.style.display = 'flex';
                        cLength.style.alignItems = 'center';
                        cLength.style.gap = '5px';

                        const cAltitude = document.createElement('div');
                        const altitudeImg = new Image();
                        altitudeImg.src = "./image/icons8-elevation-32.png";
                        const altitude = document.createElement('div');
                        altitude.textContent = item.altitude + ' m';
                        cAltitude.appendChild(altitudeImg);
                        cAltitude.appendChild(altitude);
                        box2.appendChild(cAltitude);
                        cAltitude.style.display = 'flex';
                        cAltitude.style.alignItems = 'center';
                        cAltitude.style.gap = '10px';

                        const box3 = document.createElement('div');
                        box3.className = 'info2';

                        const technique = document.createElement('div');
                        technique.textContent = 'Technique';
                        const t = item.technique;
                        const gap = document.createElement('br');
                        technique.appendChild(gap);
                        technique.className = 'technique';
                        for (let i = 0; i <= t; i++){
                            const tImage = new Image();
                            tImage.src = "./image/icons8-mountains-67.png";
                            tImage.style.height = '40px';
                            technique.appendChild(tImage);
                        }
                        box3.appendChild(technique);

                        const stamina = document.createElement('div');
                        stamina.textContent = 'Stamina';
                        const s = item.stamina;
                        const gap2 = document.createElement('br');
                        stamina.appendChild(gap2);
                        stamina.className = 'stamina';
                        for (let i = 0; i <= s; i++){
                            const sImg = new Image();
                            sImg.src = "./image/icons8-fitness-85.png";
                            sImg.style.height = '40px';
                            stamina.appendChild(sImg);
                        }
                        box3.appendChild(stamina);

                        const strength = document.createElement('div');
                        strength.textContent = 'Strength';
                        const st = item.strength;
                        const gap3 = document.createElement('br');
                        strength.appendChild(gap3);
                        strength.className = 'strength';
                        for (let i = 0; i <= st; i++){
                            const stImg = new Image();
                            stImg.src = "./image/icons8-fitness-30.png";
                            stImg.style.height = '40px';
                            strength.appendChild(stImg);
                        }
                        box3.appendChild(strength);

                        const landscape = document.createElement('div');
                        landscape.textContent = 'Landscape';
                        const l = item.landscape;
                        const gap4 = document.createElement('br');
                        landscape.appendChild(gap4);
                        landscape.className = 'landscape';
                        for (let i = 0; i <= l; i++){
                            const lImg = new Image();
                            lImg.src = "./image/icons8-landscape-16.png";
                            lImg.style.height = '40px';
                            landscape.appendChild(lImg);
                        }
                        box3.appendChild(landscape);



                        list.appendChild(name);
                        list.appendChild(myMap);
                        list.appendChild(description);
                        list.appendChild(img);
                        list.appendChild(box2);
                        list.appendChild(box3);







                        const start = item.starting_point.split(', ');

                        const map = L.map('map').setView([start[0], start[1]], 15);
                        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            maxZoom: 19,
                        }).addTo(map);

                        const mStart = new L.Marker([start[0], start[1]]).addTo(map);
                        const first = item.stop_one.split(', ');
                        const mFirst = new L.Marker([first[0], first[1]]).addTo(map);
                        const second = item.stop_two.split(', ');
                        const mSecond = new L.Marker([second[0], second[1]]).addTo(map);
                        const three = item.stop_three.split(', ');
                        const mThree = new L.Marker([three[0], three[1]]).addTo(map);
                        const end = item.finishing_point.split(', ');
                        const mEnd = new L.Marker([end[0], end[1]]).addTo(map);

                        const polyCoordinates = [
                            [start[0], start[1]],
                            [first[0], first[1]],
                            [second[0], second[1]],
                            [three[0], three[1]],
                            [end[0], end[1]]
                        ];
                        const route = L.Routing.control({
                            waypoints: polyCoordinates
                        }).addTo(map);

                        const polyline = L.polyline(polyCoordinates);



                        map.fitBounds(polyline.getBounds());


                    }
                });
            })
            .catch(error => console.error('Fetch error:', error));
    }

    fetchHike();

    const likeBtn = document.querySelector('.like');
    let isLiked = false;
    const likeClick = () => {
// if the like button hasn't been clicked
        if (!isLiked) {
            likeBtn.classList.add('isLiked');
            likeBtn.src = "./image/icons8-like-48.png";
            isLiked = true;
        }
// if the like button has been clicked
        else {

            likeBtn.classList.remove('isLiked');
            likeBtn.src = "./image/icons8-like-50.png";
            isLiked = false;
        }
    };
    // Event Listeners
    likeBtn.addEventListener('click', likeClick);




</script>
</body>
</html>